/* Code cleaning and Verfication exercise
Step 1: Merge 2A-2B with returns
*******************************************************************
Step 2: Merge returns with commodity codes
*******************************************************************
Step 3: Merge returns with DP-1
Step 4: Merge commodity codes with DP-1
Step 5: What are the number of returns per Tin
Step 6: Try and see what are the unique id combinations in each file. Keep the log.
Step 7: Calculate unique tins in each file and compare with each other
Step 8: Check how many unique tin numbers are matching up with each other
Step 9 : Merge cancelled Dealers with returns data and dealer profiles
*/

*******************************************************************
********************STEP 2.1*****************************************
*******************************************************************
*First we create another table with unique entries for id dealertin combo
* and we also delete missing ids

* Then we keep only unique combinations of id and DealerTIN in returns data

cd "D:\data"

use "form16_data.dta", clear
gsort  id DealerTIN
by id DealerTIN: gen ReturnCount = _n
drop if ReturnCount!=1
drop if id=="0"
save "DataVerification\step2\form16_uniquetinandid_for_commoditycodes.dta", replace


use "TableCommodityCode.dta", clear
drop if id==""
gsort  id DealerTIN
by id DealerTIN: gen ReturnCount = _n
drop if ReturnCount!=1

merge 1:1 id DealerTIN using "DataVerification\step2\form16_uniquetinandid_for_commoditycodes.dta", keepusing(TaxPeriod PeriodEnd PeriodBegin)

/*
. merge 1:1 id DealerTIN using "D:\data\form16_uniquetinandid_for_commoditycodes.dta", ke
> epusing(TaxPeriod PeriodEnd PeriodBegin)

    Result                           # of obs.
    -----------------------------------------
    not matched                     3,629,630
        from master                   610,860  (_merge==1)
        from using                  3,018,770  (_merge==2)

    matched                         2,576,067  (_merge==3)
    -----------------------------------------

. tab TaxPeriod if _merge==2

The tax period for 
which the returns has 
been filed       Freq.	Percent	Cum.
		
99-2012           4	0.00	0.00
Annual-2010      27,338	0.91	0.91
Annual-2011      26,806	0.89	1.79
Annual-2012         407	0.01	1.81
Anually-2010           1	0.00	1.81
Apr-2010      15,661	0.52	2.33
Apr-2011      17,130	0.57	2.89
Apr-2012      26,821	0.89	3.78
Apr-2013       1,197	0.04	3.82
Aug-2010      15,107	0.50	4.32
Aug-2011      16,692	0.55	4.87
Aug-2012      24,972	0.83	5.70
Dec-2010      14,775	0.49	6.19
Dec-2011      16,604	0.55	6.74
Dec-2012      25,033	0.83	7.57
Feb-2010           1	0.00	7.57
Feb-2011      14,657	0.49	8.06
Feb-2012      16,371	0.54	8.60
Feb-2013      24,696	0.82	9.42
First Halfyearly-2011           1	0.00	9.42
First Quarter -2011           1	0.00	9.42
First Quarter-2010     100,081	3.32	12.73
First Quarter-2011     111,076	3.68	16.41
First Quarter-2012     241,627	8.00	24.42
First Quarter-2013       8,255	0.27	24.69
First Quarter-2014       8,344	0.28	24.97
First Quater-2010           2	0.00	24.97
First Quater-2011           5	0.00	24.97
First halfyearly-2010      55,092	1.82	26.79
First halfyearly-2011      54,989	1.82	28.61
First halfyearly-2012          85	0.00	28.62
First halfyerly-2010           1	0.00	28.62
First quaterly-2012           1	0.00	28.62
Forth Quarter-2008           1	0.00	28.62
Forth Quarter-2012           1	0.00	28.62
Forth Quater-2011           1	0.00	28.62
Fourth Quarter -2011           2	0.00	28.62
Fourth Quarter-2007           1	0.00	28.62
Fourth Quarter-2010     110,654	3.67	32.28
Fourth Quarter-2011     124,043	4.11	36.39
Fourth Quarter-2012     290,255	9.62	46.01
Fourth Quarter-2013      10,079	0.33	46.34
Fourth Quarter-2014       9,349	0.31	46.65
Fourth Quater-2010           1	0.00	46.65
Fourth Quater-2011           2	0.00	46.65
Jan-2011      14,675	0.49	47.13
Jan-2012      16,356	0.54	47.68
Jan-2013      24,767	0.82	48.50
Jul-2010      15,124	0.50	49.00
Jul-2011      16,624	0.55	49.55
Jul-2012      25,605	0.85	50.40
July-2011           1	0.00	50.40
Jun-2010      15,435	0.51	50.91
Jun-2011      17,028	0.56	51.47
Jun-2012      26,272	0.87	52.34
Mar-2011      15,268	0.51	52.85
Mar-2012      17,055	0.56	53.41
Mar-2013      25,802	0.85	54.27
May-2010      15,259	0.51	54.77
May-2011      17,100	0.57	55.34
May-2012      27,039	0.90	56.24
May-2013           8	0.00	56.24
Nov-2010      14,806	0.49	56.73
Nov-2011      16,572	0.55	57.28
Nov-2012      24,649	0.82	58.09
Oct-2010      15,001	0.50	58.59
Oct-2011      16,654	0.55	59.14
Oct-2012      25,368	0.84	59.98
Second Halfyealy-2010           1	0.00	59.98
Second Halfyearly-2010           2	0.00	59.98
Second Halfyearly-2011           3	0.00	59.98
Second Quarter -2011           1	0.00	59.98
Second Quarter-2008           1	0.00	59.98
Second Quarter-2009           2	0.00	59.98
Second Quarter-2010     103,930	3.44	63.42
Second Quarter-2011     115,266	3.82	67.24
Second Quarter-2012     253,503	8.40	75.64
Second Quarter-2013      37,206	1.23	76.87
Second Quarter-2014       9,375	0.31	77.18
Second Quater-2010           1	0.00	77.18
Second Quater-2011           5	0.00	77.18
Second halfyearly-2010      54,360	1.80	78.98
Second halfyearly-2011      53,931	1.79	80.77
Second halfyearly-2012           6	0.00	80.77
Second quaterly-2012           1	0.00	80.77
Sep-2010      15,357	0.51	81.28
Sep-2011      17,011	0.56	81.84
Sep-2012      24,958	0.83	82.67
Third Quarter -2011           2	0.00	82.67
Third Quarter-2008           1	0.00	82.67
Third Quarter-2009           1	0.00	82.67
Third Quarter-2010     106,003	3.51	86.18
Third Quarter-2011     119,383	3.95	90.14
Third Quarter-2012     275,426	9.12	99.26
Third Quarter-2013      12,706	0.42	99.68
Third Quarter-2014       9,628	0.32	100.00
Third Quater-2010           2	0.00	100.00
Third Quater-2011           5	0.00	100.00
Third quaterly-2012           1	0.00	100.00
Thrid Quater-2010           1	0.00	100.00
Thrid Quater-2012           1	0.00	100.00
		
Total   3,018,770	100.00
	
	*/
*******************************************************************
********************STEP 2.2*****************************************
*******************************************************************
* Now we merge only on id

* Then we keep only unique combinations of id and DealerTIN in returns data
use "form16_data.dta", clear
gsort  id DealerTIN
by id: gen ReturnCount = _n
drop if ReturnCount!=1
drop if id=="0"
save "DataVerification\step2\form16_uniqueid_for_commoditycodes.dta", replace

	
use "TableCommodityCode.dta", clear
drop if id==""
gsort  id DealerTIN
by id: gen ReturnCount = _n
drop if ReturnCount!=1

merge 1:1 id using "DataVerification\step2\form16_uniqueid_for_commoditycodes.dta", keepusing(TaxPeriod PeriodEnd PeriodBegin)
/*


.	merge 1:1 id using "D:\data\form16_uniqueid_for_commoditycodes.dta",	keepusing(TaxPerio
>	d PeriodEnd PeriodBegin)

	Result                           # of obs.
	-----------------------------------------
	not matched                     3,610,063
	from master                   600,991  (_merge==1)
	from using                  3,009,072  (_merge==2)

	matched                         2,585,736  (_merge==3)
	-----------------------------------------

*/
*******************************************************************
********************STEP 2.3*****************************************
*******************************************************************
*Finally we delete missing ids in the commodity code file and then do an m:1 mege

* Then we keep only unique combinations of id and DealerTIN in returns data

use "TableCommodityCode.dta", clear
drop if id==""


merge m:1 id DealerTIN using "step2\form16_uniquetinandid_for_commoditycodes.dta", keepusing(TaxPeriod PeriodEnd PeriodBegin)


/*

.	do "C:\Users\ADMINI~1\AppData\Local\Temp\2\STD00000000.tmp"

.	merge m:1 id DealerTIN using "D:\data\step2\form16_uniquetinandid_for_commoditycodes.dt
>	a", keepusing(TaxPeriod PeriodEnd PeriodBegin)

	Result                           # of obs.
	-----------------------------------------
	not matched                     4,241,907
	from master                 1,223,137  (_merge==1)
	from using                  3,018,770  (_merge==2)

	matched                         6,428,752  (_merge==3)
*/

/* Lets look at number of dealers who deal in single commodities
keep if _merge==1
by DealerTIN CommodityCode: gen RunningCount=_n
drop if RunningCount!=1
br
drop RunningCount
by DealerTIN: gen RunningCount=_n
tab RunningCount

tab RunningCount

RunningCoun 
t       Freq.	Percent	Cum.
		
1     273,015	66.87	66.87
2      91,799	22.48	89.35
3      27,999	6.86	96.21
4       8,694	2.13	98.34
5       3,301	0.81	99.15
6       1,342	0.33	99.48
7         676	0.17	99.64
8         411	0.10	99.74
9         265	0.06	99.81
10         185	0.05	99.85
11         134	0.03	99.89
12          95	0.02	99.91
13          68	0.02	99.93
14          58	0.01	99.94
15          39	0.01	99.95
16          33	0.01	99.96
17          24	0.01	99.96
18          20	0.00	99.97
19          16	0.00	99.97
20          11	0.00	99.98
21          11	0.00	99.98
22           9	0.00	99.98
23           8	0.00	99.98
24           7	0.00	99.98
25           7	0.00	99.99
26           7	0.00	99.99
27           6	0.00	99.99
28           6	0.00	99.99
29           6	0.00	99.99
30           6	0.00	99.99
31           6	0.00	100.00
32           4	0.00	100.00
33           3	0.00	100.00
34           2	0.00	100.00
35           2	0.00	100.00
36           2	0.00	100.00
37           1	0.00	100.00
38           1	0.00	100.00
39           1	0.00	100.00
40           1	0.00	100.00
41           1	0.00	100.00
42           1	0.00	100.00
43           1	0.00	100.00
		
Total     408,284	100.00

keep if RunningCount==1
isid DealerTIN (is unique)
*/

*******************************************************************
********************STEP 2.4*****************************************
*******************************************************************
* Now we try to identify the distribution of commodities each dealer deals in
use "TableCommodityCode.dta", clear
gsort DealerTIN CommodityCode id
by DealerTIN CommodityCode:gen ReturnCount=_n
keep if ReturnCount==1
drop ReturnCount
by DealerTIN: gen ReturnCount=_n
tab ReturnCount

gen dummy=1
by DealerTIN: egen TotalCount=sum(dummy)
tab TotalCount

/*****************************************************************************
. tab TotalCount
TotalCount	Freq.	Percent	Cum.
			
1	151,501	25.43	25.43
2	183,894	30.87	56.30
3	127,320	21.37	77.67
4	63,624	10.68	88.34
5	31,560	5.30	93.64
6	14,700	2.47	96.11
7	7,539	1.27	97.37
8	4,536	0.76	98.14
9	2,925	0.49	98.63
10	1,890	0.32	98.94
11	1,331	0.22	99.17
12	936	0.16	99.32
13	832	0.14	99.46
14	574	0.10	99.56
15	525	0.09	99.65
16	400	0.07	99.72
17	255	0.04	99.76
18	216	0.04	99.80
19	209	0.04	99.83
20	120	0.02	99.85
21	105	0.02	99.87
22	66	0.01	99.88
23	46	0.01	99.89
24	96	0.02	99.90
25	50	0.01	99.91
26	78	0.01	99.92
28	28	0.00	99.93
29	58	0.01	99.94
30	30	0.01	99.94
31	31	0.01	99.95
32	64	0.01	99.96
34	34	0.01	99.97
36	72	0.01	99.98
40	40	0.01	99.98
44	44	0.01	99.99
49	49	0.01	100.00
			
Total	595,778	100.00
*********************************************************************/

tab CommodityCode if TotalCount==1,	sort
/*
CommodityCo 
de       Freq.     Percent		Cum.
		
904001      18,413       12.15		12.15
214000       8,477        5.60		17.75
508000       5,688        3.75		21.50
607000       4,851        3.20		24.71
301000       4,150        2.74		27.44
308000       3,507        2.31		29.76
324000       2,756        1.82		31.58
213000       2,719        1.79		33.37
316000       2,680        1.77		35.14
813000       2,595        1.71		36.86
515500       2,497        1.65		38.50
321000       2,496        1.65		40.15
507000       2,494        1.65		41.80
90210       2,198        1.45		43.25
807000       1,975        1.30		44.55
408000       1,961        1.29		45.85
417000       1,862        1.23		47.07
609000       1,678        1.11		48.18
113000       1,673        1.10		49.29
814001       1,657        1.09		50.38
601000       1,620        1.07		51.45
312001       1,563        1.03		52.48
203000       1,521        1.00		53.49
90201       1,516        1.00		54.49
603000       1,506        0.99		55.48
521000       1,478        0.98		56.46
601003       1,457        0.96		57.42
215000       1,414        0.93		58.35
802000       1,319        0.87		59.22
822000       1,311        0.87		60.09
825000       1,241        0.82		60.91
604000       1,163        0.77		61.67
101004       1,097        0.72		62.40
426002       1,050        0.69		63.09
426000       1,040        0.69		63.78
801000       1,013        0.67		64.45
331000         985        0.65		65.10
425000         966        0.64		65.73
408800         931        0.61		66.35
426001         931        0.61		66.96
507001         850        0.56		67.52
130000         795        0.52		68.05
609003         791        0.52		68.57
821000         741        0.49		69.06
509000         739        0.49		69.55
211002         724        0.48		70.03
520500         722        0.48		70.50
315000         719        0.47		70.98
323001         713        0.47		71.45
134000         704        0.46		71.91
333000         703        0.46		72.38
220001         700        0.46		72.84
312000         671        0.44		73.28
427000         667        0.44		73.72
804000         666        0.44		74.16
211000         661        0.44		74.60
324001         659        0.43		75.03
323002         616        0.41		75.44
327000         606        0.40		75.84
511000         581        0.38		76.22
808000         578        0.38		76.60
505500         567        0.37		76.98
307001         554        0.37		77.34
313000         552        0.36		77.71
323000         537        0.35		78.06
217004         536        0.35		78.42
90209         506        0.33		78.75
117000         505        0.33		79.08
505000         498        0.33		79.41
101000         490        0.32		79.74
216500         466        0.31		80.04
803000         466        0.31		80.35
523000         465        0.31		80.66
307008         460        0.30		80.96
320000         454        0.30		81.26
810000         444        0.29		81.55
516000         441        0.29		81.85
526000         434        0.29		82.13
319000         422        0.28		82.41
403000         420        0.28		82.69
430001         413        0.27		82.96
407000         411        0.27		83.23
514000         407        0.27		83.50
334000         395        0.26		83.76
332000         391        0.26		84.02
605000         389        0.26		84.28
305000         384        0.25		84.53
522000         378        0.25		84.78
813003         372        0.25		85.02
317000         364        0.24		85.26
902000         360        0.24		85.50
306000         359        0.24		85.74
507500         347        0.23		85.97
501000         339        0.22		86.19
113500         335        0.22		86.41
90203         335        0.22		86.63
106000         334        0.22		86.85
218000         332        0.22		87.07
128000         329        0.22		87.29
822001         308        0.20		87.49
314000         307        0.20		87.70
219001         303        0.20		87.90
520003         303        0.20		88.10
116000         287        0.19		88.29
112000         284        0.19		88.47
108000         273        0.18		88.65
529000         273        0.18		88.83
411000         269        0.18		89.01
325000         265        0.17		89.19
318000         263        0.17		89.36
101003         250        0.17		89.52
132001         245        0.16		89.69
813004         244        0.16		89.85
304000         238        0.16		90.00
520002         235        0.16		90.16
131000         233        0.15		90.31
201000         233        0.15		90.47
217000         231        0.15		90.62
212000         212        0.14		90.76
515000         207        0.14		90.90
507002         203        0.13		91.03
522500         193        0.13		91.16
507005         191        0.13		91.28
517000         185        0.12		91.41
814002         184        0.12		91.53
505001         183        0.12		91.65
506001         181        0.12		91.77
132000         180        0.12		91.89
310000         179        0.12		92.00
524000         178        0.12		92.12
132003         175        0.12		92.24
208000         173        0.11		92.35
513000         173        0.11		92.47
309000         165        0.11		92.57
703000         159        0.10		92.68
825004         158        0.10		92.78
311000         154        0.10		92.89
817004         149        0.10		92.98
326000         147        0.10		93.08
207003         145        0.10		93.18
124000         144        0.10		93.27
133000         139        0.09		93.36
504000         137        0.09		93.45
412000         136        0.09		93.54
601004         134        0.09		93.63
101005         123        0.08		93.71
326001         123        0.08		93.79
819000         123        0.08		93.88
820000         122        0.08		93.96
307006         121        0.08		94.04
525000         119        0.08		94.11
324002         118        0.08		94.19
510000         118        0.08		94.27
207000         116        0.08		94.35
210000         116        0.08		94.42
-1         115        0.08		94.50
129000         112        0.07		94.57
135006         111        0.07		94.65
904000         106        0.07		94.72
807002         105        0.07		94.79
901000         103        0.07		94.85
306001         102        0.07		94.92
814003         102        0.07		94.99
113004          99        0.07		95.05
807004          99        0.07		95.12
815000          98        0.06		95.18
813501          97        0.06		95.25
90205          97        0.06		95.31
401000          95        0.06		95.37
429000          95        0.06		95.44
602000          89        0.06		95.50
113003          88        0.06		95.55
118000          88        0.06		95.61
330000          87        0.06		95.67
408500          87        0.06		95.73
507505          86        0.06		95.78
206500          85        0.06		95.84
507503          85        0.06		95.90
825002          85        0.06		95.95
210500          83        0.05		96.01
304500          82        0.05		96.06
307002          82        0.05		96.12
804002          82        0.05		96.17
813002          82        0.05		96.22
817002          81        0.05		96.28
121000          79        0.05		96.33
817000          79        0.05		96.38
704000          77        0.05		96.43
211004          76        0.05		96.48
102000          75        0.05		96.53
812000          75        0.05		96.58
502000          74        0.05		96.63
518000          74        0.05		96.68
104000          73        0.05		96.73
507003          73        0.05		96.78
704001          71        0.05		96.82
813500          70        0.05		96.87
332002          69        0.05		96.91
507501          69        0.05		96.96
705000          67        0.04		97.00
211001          66        0.04		97.05
415000          65        0.04		97.09
818000          65        0.04		97.13
410000          63        0.04		97.17
519000          63        0.04		97.22
90202          62        0.04		97.26
901001          61        0.04		97.30
307003          60        0.04		97.34
135000          59        0.04		97.38
216000          59        0.04		97.42
121003          57        0.04		97.45
219000          57        0.04		97.49
206503          56        0.04		97.53
207002          54        0.04		97.56
506000          54        0.04		97.60
312004          53        0.03		97.63
507006          53        0.03		97.67
824000          53        0.03		97.70
203003          52        0.03		97.74
104002          51        0.03		97.77
302000          51        0.03		97.81
327003          50        0.03		97.84
609002          49        0.03		97.87
520001          48        0.03		97.90
130004          47        0.03		97.93
202000          44        0.03		97.96
701000          44        0.03		97.99
813502          44        0.03		98.02
114000          43        0.03		98.05
308001          42        0.03		98.08
418000          42        0.03		98.10
512000          42        0.03		98.13
507506          41        0.03		98.16
608000          41        0.03		98.19
131001          40        0.03		98.21
308003          40        0.03		98.24
322000          40        0.03		98.27
706003          40        0.03		98.29
431000          39        0.03		98.32
110000          38        0.03		98.34
806000          38        0.03		98.37
203500          37        0.02		98.39
414000          37        0.02		98.42
323004          36        0.02		98.44
407500          36        0.02		98.46
220000          35        0.02		98.49
601002          35        0.02		98.51
135005          34        0.02		98.53
204000          34        0.02		98.56
702001          34        0.02		98.58
804001          34        0.02		98.60
122001          33        0.02		98.62
209004          33        0.02		98.64
222001          33        0.02		98.67
308005          33        0.02		98.69
332003          33        0.02		98.71
527000          32        0.02		98.73
825001          32        0.02		98.75
205000          31        0.02		98.77
322003          31        0.02		98.79
520000          31        0.02		98.81
102004          30        0.02		98.83
307004          30        0.02		98.85
503000          30        0.02		98.87
507004          30        0.02		98.89
122000          29        0.02		98.91
209001          29        0.02		98.93
523001          29        0.02		98.95
421000          28        0.02		98.97
531000          28        0.02		98.99
128001          27        0.02		99.00
805000          27        0.02		99.02
103000          26        0.02		99.04
107002          26        0.02		99.06
610000          26        0.02		99.07
90204          26        0.02		99.09
122002          25        0.02		99.11
127000          25        0.02		99.12
430003          25        0.02		99.14
90208          25        0.02		99.16
101002          24        0.02		99.17
408501          24        0.02		99.19
111000          23        0.02		99.20
814004          23        0.02		99.22
903000          23        0.02		99.23
131003          22        0.01		99.25
203002          22        0.01		99.26
206501          22        0.01		99.28
221001          22        0.01		99.29
314500          22        0.01		99.31
90206          22        0.01		99.32
90207          22        0.01		99.34
221000          21        0.01		99.35
416000          21        0.01		99.36
115000          20        0.01		99.38
420000          20        0.01		99.39
121002          19        0.01		99.40
130003          19        0.01		99.41
322001          19        0.01		99.43
814000          19        0.01		99.44
123000          18        0.01		99.45
530000          18        0.01		99.46
131004          17        0.01		99.47
222000          17        0.01		99.49
104003          16        0.01		99.50
328000          16        0.01		99.51
424000          16        0.01		99.52
811000          16        0.01		99.53
814005          16        0.01		99.54
821001          16        0.01		99.55
107001          14        0.01		99.56
308006          14        0.01		99.57
109000          13        0.01		99.58
201500          13        0.01		99.58
209002          13        0.01		99.59
303000          13        0.01		99.60
409000          13        0.01		99.61
706000          13        0.01		99.62
807003          13        0.01		99.63
809000          13        0.01		99.64
307007          12        0.01		99.64
702002          12        0.01		99.65
901002          12        0.01		99.66
131002          11        0.01		99.67
206000          11        0.01		99.67
211005          11        0.01		99.68
306002          11        0.01		99.69
307011          11        0.01		99.70
402000          11        0.01		99.70
404000          11        0.01		99.71
507502          11        0.01		99.72
101001          10        0.01		99.72
135001          10        0.01		99.73
135003          10        0.01		99.74
307000          10        0.01		99.74
406000          10        0.01		99.75
428000          10        0.01		99.76
531003          10        0.01		99.76
807001          10        0.01		99.77
106003           9        0.01		99.78
802001           9        0.01		99.78
824001           9        0.01		99.79
90211           9        0.01		99.79
209000           8        0.01		99.80
307009           8        0.01		99.81
703001           8        0.01		99.81
107000           7        0.00		99.82
107003           7        0.00		99.82
120000           7        0.00		99.82
207004           7        0.00		99.83
211006           7        0.00		99.83
307010           7        0.00		99.84
422000           7        0.00		99.84
704002           7        0.00		99.85
706002           7        0.00		99.85
102002           6        0.00		99.86
104001           6        0.00		99.86
221002           6        0.00		99.86
312002           6        0.00		99.87
327004           6        0.00		99.87
405000           6        0.00		99.88
413000           6        0.00		99.88
508001           6        0.00		99.88
606004           6        0.00		99.89
702000           6        0.00		99.89
823000           6        0.00		99.90
113001           5        0.00		99.90
125000           5        0.00		99.90
2011893           5        0.00		99.91
201501           5        0.00		99.91
217001           5        0.00		99.91
307005           5        0.00		99.92
327002           5        0.00		99.92
328001           5        0.00		99.92
423000           5        0.00		99.93
601001           5        0.00		99.93
105000           4        0.00		99.93
130002           4        0.00		99.93
203001           4        0.00		99.94
209003           4        0.00		99.94
217002           4        0.00		99.94
507504           4        0.00		99.94
531002           4        0.00		99.95
606000           4        0.00		99.95
606006           4        0.00		99.95
703002           4        0.00		99.96
825003           4        0.00		99.96
106001           3        0.00		99.96
121001           3        0.00		99.96
312003           3        0.00		99.96
327005           3        0.00		99.97
332001           3        0.00		99.97
419000           3        0.00		99.97
505501           3        0.00		99.97
813001           3        0.00		99.97
817001           3        0.00		99.98
102003           2        0.00		99.98
113002           2        0.00		99.98
119000           2        0.00		99.98
131005           2        0.00		99.98
132002           2        0.00		99.98
135004           2        0.00		99.98
217003           2        0.00		99.98
220002           2        0.00		99.99
308004           2        0.00		99.99
327001           2        0.00		99.99
334001           2        0.00		99.99
432000           2        0.00		99.99
531001           2        0.00		99.99
606001           2        0.00		99.99
706001           2        0.00		100.00
102001           1        0.00		100.00
106002           1        0.00		100.00
131006           1        0.00		100.00
207001           1        0.00		100.00
329000           1        0.00		100.00
430000           1        0.00		100.00
606003           1        0.00		100.00
		
Total     151,501      100.00
*/


. tab CommodityCode if TotalCount==1&CommodityCode=="109000",	sort
/*
These are dealers only in ghee.
CommodityCode  Freq.     Percent        Cum.

109000          13      100.00      100.00

Total          13      100.00
*/

/***********************************************************************
*******************STEP 2.5********************************************
Tried to see unique tin numbers from returns and if they merge with all the commodity codes
************************************************************************/
use "D:\data\TableCommodityCode.dta", clear
drop if id==""
merge m:1 id DealerTIN using "DataVerification\step2\form16_uniquetinandid_for_commoditycodes.dta", keepusing(TaxPeriod PeriodEnd PeriodBegin)

gsort DealerTIN -_merge
gen dummy=1 if _merge==3
by DealerTIN: replace dummy=dummy[_n-1] if dummy>=.

tab dummy _merge, missing

/*
           |              _merge
     dummy | master on  using onl  matched ( |     Total
-----------+---------------------------------+----------
         1 | 1,063,318  2,759,767  6,428,752 |10,251,837 
         . |   159,819    259,003          0 |   418,822 
-----------+---------------------------------+----------
     Total | 1,223,137  3,018,770  6,428,752 |10,670,659 
	 
So 159,819 observations never appear in any returns. It could be that these observations are from the 
future quarters for which we do not have data. No way to verify
	 
259,003 observations in returns, never have any observation in commodity code. Most of these are from pre 2013.
Some of them are from recent time periods.	 
	 
	 
	 
	 */





